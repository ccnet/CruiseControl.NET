<?xml version="1.0" encoding="utf-8"?>
<configuration>
  <configSections>
    <section name="xslFiles" type="ThoughtWorks.CruiseControl.Core.Config.XslFilesSectionHandler,ThoughtWorks.CruiseControl.Core"/>
    <section name="log4net" type="log4net.Config.Log4NetConfigurationSectionHandler, log4net"/>
    <section name="cruiseServer" type="ThoughtWorks.CruiseControl.Core.Config.ServerConfigurationHandler,ThoughtWorks.CruiseControl.Core"/>
  </configSections>
  <!-- Specifies the stylesheets that are used to transform the build results when using the EmailPublisher -->
  <xslFiles>
    <file name="xsl\header.xsl"/>
    <file name="xsl\compile.xsl"/>
    <file name="xsl\unittests.xsl"/>
    <file name="xsl\fit.xsl"/>
    <file name="xsl\modifications.xsl"/>
    <file name="xsl\fxcop-summary_1_36.xsl"/>
  </xslFiles>
  <cruiseServer>
  </cruiseServer>
  <!-- Defines the port and protocol that the ccnet server will use to service remote requests -->
  <system.runtime.remoting>
    <application>
      <channels>
        <channel ref="tcp" port="21234">
          <serverProviders>
            <formatter ref="binary" typeFilterLevel="Full"/>
          </serverProviders>
        </channel>
      </channels>
    </application>
  </system.runtime.remoting>
  <appSettings>
    <!-- 
	     Used by the WebDashboard ServerLog plugin to locate the log file produced by the LogFileTraceListener from Log4Net
	     must be the same value as in the logger named RollingFileAppender in the log4Net section below.
	-->
    <add key="ServerLogFilePath" value="${TMP}\ccnet.log"/>
    
    <!-- Used by the WebDashboard ServerLog plugin to determine how many lines from the log file should be read -->    
    <add key="ServerLogFileLines" value="100"/>

    <!-- Turns on or off the file watcher used to monitor the ccnet.config file -->
    <add key="WatchConfigFile" value="true"/>

    <!--when filled in this location is also scanned for assemblies following the name convention : ccnet.*.plugin  (case sensitive)-->
    <add key="PluginLocation" value=""/>

    <!-- the main data drive used by CruiseControl.NET. This is used for checking the amount of free disk space. Defaults to c:\   -->
    <add key="DataDrive" value=""/>

    <!-- The amount of time (in seconds) a build log will be cached for before it is expired. The minimum allowed value is 10 seconds. Default 5 minutes -->
    <add key="cacheTime" value=""/>


  </appSettings>
  <startup>
  </startup>
  <log4net>
    <level>
      <name value="TRACE" />
      <value value="20000" />
    </level>
    <root>
      <!-- 
				Change the value in the next line to alter the amount of logging generated by CruiseControl.NET.
				The following values are supported: TRACE, DEBUG, INFO, WARN, ERROR, OFF.
				For more detailed information on how to configure log4net, see http://logging.apache.org/log4net/
				 -->
      <level value="TRACE"/>
      <appender-ref ref="Console"/>
      <appender-ref ref="RollingFileAppender"/>
      <appender-ref ref="EventLogAppender"/>
      <appender-ref ref="TraceAppender"/>
    </root>

    <appender name="Console" type="log4net.Appender.ColoredConsoleAppender">
      <mapping>
        <level value="ERROR"/>
        <foreColor value="White"/>
        <backColor value="Red, HighIntensity"/>
      </mapping>
      <mapping>
        <level value="DEBUG"/>
        <foreColor value="Green"/>
      </mapping>
      <mapping>
        <level value="WARN"/>
        <foreColor value="White"/>
        <backColor value="Blue, HighIntensity"/>
      </mapping>
      <mapping>
        <level value="INFO"/>
        <foreColor value="White"/>
      </mapping>
      
      <layout type="log4net.Layout.PatternLayout">
        <conversionPattern value="[%thread:%level] %message%newline"/>
      </layout>
      
      <filter type="log4net.Filter.LevelRangeFilter">
        <acceptOnMatch value="true" />
        <levelMin value="DEBUG" />
        <levelMax value="ERROR" />
      </filter>
    </appender>
    
    <appender name="RollingFileAppender" type="log4net.Appender.RollingFileAppender">
   <!-- 
	     Used by the server to output the logs, if you change this location, also change the appsettings above
		 <add key="ServerLogFilePath" />
		 accordingly, so the webDashboard can find the log file.
	-->
  
      <file value="${TMP}\ccnet.log"/>
      <appendToFile value="true"/>
      <rollingStyle value="Size"/>
      <maxSizeRollBackups value="10"/>
      <maximumFileSize value="10MB"/>
      <staticLogFileName value="true"/>
     
      <layout type="log4net.Layout.PatternLayout">
        <conversionPattern value="%date [%thread:%level] %message%newline"/>
      </layout>

      <filter type="log4net.Filter.LevelRangeFilter">
        <acceptOnMatch value="true" />
        <levelMin value="DEBUG" />
        <levelMax value="ERROR" />
      </filter>
    </appender>

    <appender name="EventLogAppender" type="log4net.Appender.EventLogAppender" >
      <layout type="log4net.Layout.PatternLayout">
        <conversionPattern value="%date [%thread] %-5level %logger [%property{NDC}] - %message%newline" />
      </layout>

      <filter type="log4net.Filter.LevelRangeFilter">
        <levelMin value="ERROR" />
        <levelMax value="ERROR" />
      </filter>      
    </appender>


    <appender name="TraceAppender" type="log4net.Appender.RollingFileAppender" >
      <file value="${TMP}\ccnet.trace"/>
      <appendToFile value="true"/>
      <rollingStyle value="Size"/>
      <maxSizeRollBackups value="10"/>
      <maximumFileSize value="10MB"/>
      <staticLogFileName value="true"/>

      <layout type="log4net.Layout.PatternLayout">
        <conversionPattern value="%date [%thread] [%level] - %message%newline" />
      </layout>

    </appender>
  </log4net>

  <!-- Handle backwards compatibility with previous versions of NetReflector (for plug-ins etc.) -->
  <runtime>
    <assemblyBinding xmlns="urn:schemas-microsoft-com:asm.v1">
      <dependentAssembly>
        <assemblyIdentity name="NetReflector" publicKeyToken="2f4dd8b32acbcd8e" culture="neutral" />
        <bindingRedirect oldVersion="1.0.0.120" newVersion="1.1.2009.1214"/>
      </dependentAssembly>
    </assemblyBinding>
  </runtime>
</configuration>
